{"title":"Week 2: Global Air Quality","markdown":{"yaml":{"title":"Week 2: Global Air Quality","description":"Analyzing air quality measurements across major global cities","date":"2025-02-12","categories":["time series","air quality","environmental"],"image":"thumbnail.png","execute":{"echo":true,"warning":false}},"headingText":"Replace tidyverse with individual packages","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nlibrary(dplyr)      # For data manipulation\nlibrary(ggplot2)    # For plotting\nlibrary(lubridate)  # For date handling\nlibrary(plotly)     # For interactive plots\nlibrary(knitr)      # For table formatting\nlibrary(kableExtra) # For enhanced table styling\n\n# This is where you'd load the air quality data\n# For this example, we'll create some sample data\nset.seed(123)\n\n# Create sample data frame\ncities <- c(\"London\", \"New York\", \"Tokyo\", \"Paris\", \"Beijing\")\ndates <- seq(as.Date(\"2024-01-01\"), as.Date(\"2024-03-01\"), by = \"day\")\n\nair_quality <- expand.grid(\n  city = cities,\n  date = dates\n)\n\nair_quality$aqi <- sample(20:200, nrow(air_quality), replace = TRUE)\nair_quality$pm25 <- air_quality$aqi * runif(nrow(air_quality), 0.3, 0.7)\nair_quality$pm10 <- air_quality$aqi * runif(nrow(air_quality), 0.6, 1.0)\nair_quality$no2 <- air_quality$aqi * runif(nrow(air_quality), 0.2, 0.5)\n\n# Add quality category\nair_quality <- air_quality %>%\n  mutate(quality_category = case_when(\n    aqi <= 50 ~ \"Good\",\n    aqi <= 100 ~ \"Moderate\",\n    aqi <= 150 ~ \"Unhealthy for Sensitive Groups\",\n    aqi <= 200 ~ \"Unhealthy\",\n    TRUE ~ \"Very Unhealthy\"\n  ))\n```\n\n## Introduction\n\nThis week's Tidy Tuesday focused on global air quality data. Air pollution is a major environmental risk to health worldwide, with outdoor air pollution responsible for millions of deaths annually. Understanding air quality trends across major cities can help inform policy decisions and public health initiatives.\n\n## The Data\n\nThe dataset contains air quality measurements from major cities around the world, including:\n\n- Air Quality Index (AQI)\n- PM2.5 levels (fine particulate matter)\n- PM10 levels (coarse particulate matter)\n- NO2 (nitrogen dioxide) levels\n\nLet's take a look at the first few rows:\n\n```{r}\n# Using kable for better table formatting\nhead(air_quality) %>%\n  kable() %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"), full_width = FALSE)\n```\n\n## Air Quality Over Time\n\nLet's visualize how air quality has changed over time in different cities:\n\n```{r fig.height=7, fig.width=10}\nggplot(air_quality, aes(x = date, y = aqi, color = city)) +\n  geom_line() +\n  geom_smooth(method = \"loess\", se = FALSE, alpha = 0.5) +\n  facet_wrap(~city, ncol = 2) +\n  labs(\n    title = \"Air Quality Index Over Time\",\n    subtitle = \"January - March 2024\",\n    x = \"Date\",\n    y = \"Air Quality Index (AQI)\",\n    color = \"City\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    strip.background = element_rect(fill = \"lightblue\", color = NA),\n    strip.text = element_text(face = \"bold\")\n  )\n```\n\n## Comparing Pollutant Levels\n\nLet's compare the different pollutant levels across cities:\n\n```{r fig.height=8, fig.width=10}\nair_quality %>%\n  group_by(city) %>%\n  summarize(\n    avg_aqi = mean(aqi),\n    avg_pm25 = mean(pm25),\n    avg_pm10 = mean(pm10),\n    avg_no2 = mean(no2)\n  ) %>%\n  tidyr::pivot_longer(\n    cols = starts_with(\"avg_\"),\n    names_to = \"pollutant\",\n    values_to = \"value\"\n  ) %>%\n  mutate(\n    pollutant = case_when(\n      pollutant == \"avg_aqi\" ~ \"Air Quality Index\",\n      pollutant == \"avg_pm25\" ~ \"PM2.5\",\n      pollutant == \"avg_pm10\" ~ \"PM10\",\n      pollutant == \"avg_no2\" ~ \"NO2\"\n    )\n  ) %>%\n  ggplot(aes(x = reorder(city, value), y = value, fill = city)) +\n  geom_col() +\n  facet_wrap(~pollutant, scales = \"free_y\", ncol = 2) +\n  coord_flip() +\n  labs(\n    title = \"Average Pollutant Levels by City\",\n    subtitle = \"January - March 2024\",\n    x = NULL,\n    y = \"Concentration\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    strip.background = element_rect(fill = \"lightgray\", color = NA),\n    strip.text = element_text(face = \"bold\")\n  )\n```\n\n## Air Quality Category Distribution\n\nLet's examine the distribution of air quality categories across cities:\n\n```{r fig.height=7, fig.width=10}\n# Plot directly with the original styling\nggplot(air_quality, aes(x = city, y = aqi, fill = quality_category)) +\n  geom_boxplot(alpha = 0.8) +\n  scale_fill_manual(values = c(\n    \"Good\" = \"#91CF60\",               # A softer green\n    \"Moderate\" = \"#FFFFBF\",           # Pale yellow\n    \"Unhealthy for Sensitive Groups\" = \"#FEE08B\", # Soft orange\n    \"Unhealthy\" = \"#FC8D59\",          # Muted red-orange\n    \"Very Unhealthy\" = \"#D73027\",     # Muted red\n    \"Hazardous\" = \"#A50026\"           # Darker red\n  )) +\n  labs(\n    title = \"Distribution of Air Quality Index by City\",\n    x = \"City\",\n    y = \"Air Quality Index (AQI)\",\n    fill = \"Air Quality Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n```\n\n## Correlation Between Pollutants\n\nLet's explore the correlation between different pollutants:\n\n```{r fig.height=8, fig.width=10}\nair_quality %>%\n  select(aqi, pm25, pm10, no2) %>%\n  cor() %>%\n  as.data.frame() %>%\n  tibble::rownames_to_column(\"pollutant1\") %>%\n  tidyr::pivot_longer(-pollutant1, names_to = \"pollutant2\", values_to = \"correlation\") %>%\n  ggplot(aes(x = pollutant1, y = pollutant2, fill = correlation)) +\n  geom_tile() +\n  geom_text(aes(label = round(correlation, 2)), color = \"white\", size = 4) +\n  scale_fill_gradient2(low = \"blue\", mid = \"white\", high = \"red\", midpoint = 0.5) +\n  labs(\n    title = \"Correlation Between Pollutants\",\n    x = NULL,\n    y = NULL,\n    fill = \"Correlation\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    panel.grid = element_blank()\n  )\n```\n\n## Key Findings\n\nFrom our analysis, we can observe:\n\n1. **City Differences**: Beijing shows the highest average AQI levels, followed by Tokyo and New York.\n2. **Pollutant Relationships**: PM10 and AQI show the strongest correlation, which is expected as PM10 is a major component of air quality calculations.\n3. **Seasonal Patterns**: All cities show some fluctuation in air quality over the period, with some improvement trends visible in specific cities.\n4. **Quality Categories**: London has the highest percentage of \"Good\" air quality days, while Beijing has the highest percentage of \"Unhealthy\" days.\n\n## Conclusions\n\nThis analysis demonstrates the variability in air quality across major global cities. The data shows that while some cities struggle with consistently poor air quality, others maintain relatively good air quality levels throughout the period. These findings highlight the need for continued monitoring and targeted interventions in cities with persistent air quality issues.\n\nFor a more comprehensive analysis, future work could explore:\n- Correlation with weather patterns\n- Impact of policy interventions on air quality\n- Relationship between air quality and health outcomes in each city\n\n## Sources and Further Reading\n\n- World Health Organization Air Quality Guidelines\n- Environmental Protection Agency Air Quality Index\n- [Our World in Data - Air Pollution](https://ourworldindata.org/air-pollution)\n\n```{r echo=FALSE}\n# Add code to save the thumbnail for the listing page\nggsave(\"thumbnail.png\", \n       plot = ggplot(air_quality, aes(x = date, y = aqi, color = city)) +\n         geom_line() +\n         geom_smooth(method = \"loess\", se = FALSE, alpha = 0.5) +\n         labs(title = \"Air Quality Index Over Time\") +\n         theme_minimal(),\n       width = 6, height = 4)\n```","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\n# Replace tidyverse with individual packages\nlibrary(dplyr)      # For data manipulation\nlibrary(ggplot2)    # For plotting\nlibrary(lubridate)  # For date handling\nlibrary(plotly)     # For interactive plots\nlibrary(knitr)      # For table formatting\nlibrary(kableExtra) # For enhanced table styling\n\n# This is where you'd load the air quality data\n# For this example, we'll create some sample data\nset.seed(123)\n\n# Create sample data frame\ncities <- c(\"London\", \"New York\", \"Tokyo\", \"Paris\", \"Beijing\")\ndates <- seq(as.Date(\"2024-01-01\"), as.Date(\"2024-03-01\"), by = \"day\")\n\nair_quality <- expand.grid(\n  city = cities,\n  date = dates\n)\n\nair_quality$aqi <- sample(20:200, nrow(air_quality), replace = TRUE)\nair_quality$pm25 <- air_quality$aqi * runif(nrow(air_quality), 0.3, 0.7)\nair_quality$pm10 <- air_quality$aqi * runif(nrow(air_quality), 0.6, 1.0)\nair_quality$no2 <- air_quality$aqi * runif(nrow(air_quality), 0.2, 0.5)\n\n# Add quality category\nair_quality <- air_quality %>%\n  mutate(quality_category = case_when(\n    aqi <= 50 ~ \"Good\",\n    aqi <= 100 ~ \"Moderate\",\n    aqi <= 150 ~ \"Unhealthy for Sensitive Groups\",\n    aqi <= 200 ~ \"Unhealthy\",\n    TRUE ~ \"Very Unhealthy\"\n  ))\n```\n\n## Introduction\n\nThis week's Tidy Tuesday focused on global air quality data. Air pollution is a major environmental risk to health worldwide, with outdoor air pollution responsible for millions of deaths annually. Understanding air quality trends across major cities can help inform policy decisions and public health initiatives.\n\n## The Data\n\nThe dataset contains air quality measurements from major cities around the world, including:\n\n- Air Quality Index (AQI)\n- PM2.5 levels (fine particulate matter)\n- PM10 levels (coarse particulate matter)\n- NO2 (nitrogen dioxide) levels\n\nLet's take a look at the first few rows:\n\n```{r}\n# Using kable for better table formatting\nhead(air_quality) %>%\n  kable() %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"), full_width = FALSE)\n```\n\n## Air Quality Over Time\n\nLet's visualize how air quality has changed over time in different cities:\n\n```{r fig.height=7, fig.width=10}\nggplot(air_quality, aes(x = date, y = aqi, color = city)) +\n  geom_line() +\n  geom_smooth(method = \"loess\", se = FALSE, alpha = 0.5) +\n  facet_wrap(~city, ncol = 2) +\n  labs(\n    title = \"Air Quality Index Over Time\",\n    subtitle = \"January - March 2024\",\n    x = \"Date\",\n    y = \"Air Quality Index (AQI)\",\n    color = \"City\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    strip.background = element_rect(fill = \"lightblue\", color = NA),\n    strip.text = element_text(face = \"bold\")\n  )\n```\n\n## Comparing Pollutant Levels\n\nLet's compare the different pollutant levels across cities:\n\n```{r fig.height=8, fig.width=10}\nair_quality %>%\n  group_by(city) %>%\n  summarize(\n    avg_aqi = mean(aqi),\n    avg_pm25 = mean(pm25),\n    avg_pm10 = mean(pm10),\n    avg_no2 = mean(no2)\n  ) %>%\n  tidyr::pivot_longer(\n    cols = starts_with(\"avg_\"),\n    names_to = \"pollutant\",\n    values_to = \"value\"\n  ) %>%\n  mutate(\n    pollutant = case_when(\n      pollutant == \"avg_aqi\" ~ \"Air Quality Index\",\n      pollutant == \"avg_pm25\" ~ \"PM2.5\",\n      pollutant == \"avg_pm10\" ~ \"PM10\",\n      pollutant == \"avg_no2\" ~ \"NO2\"\n    )\n  ) %>%\n  ggplot(aes(x = reorder(city, value), y = value, fill = city)) +\n  geom_col() +\n  facet_wrap(~pollutant, scales = \"free_y\", ncol = 2) +\n  coord_flip() +\n  labs(\n    title = \"Average Pollutant Levels by City\",\n    subtitle = \"January - March 2024\",\n    x = NULL,\n    y = \"Concentration\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    strip.background = element_rect(fill = \"lightgray\", color = NA),\n    strip.text = element_text(face = \"bold\")\n  )\n```\n\n## Air Quality Category Distribution\n\nLet's examine the distribution of air quality categories across cities:\n\n```{r fig.height=7, fig.width=10}\n# Plot directly with the original styling\nggplot(air_quality, aes(x = city, y = aqi, fill = quality_category)) +\n  geom_boxplot(alpha = 0.8) +\n  scale_fill_manual(values = c(\n    \"Good\" = \"#91CF60\",               # A softer green\n    \"Moderate\" = \"#FFFFBF\",           # Pale yellow\n    \"Unhealthy for Sensitive Groups\" = \"#FEE08B\", # Soft orange\n    \"Unhealthy\" = \"#FC8D59\",          # Muted red-orange\n    \"Very Unhealthy\" = \"#D73027\",     # Muted red\n    \"Hazardous\" = \"#A50026\"           # Darker red\n  )) +\n  labs(\n    title = \"Distribution of Air Quality Index by City\",\n    x = \"City\",\n    y = \"Air Quality Index (AQI)\",\n    fill = \"Air Quality Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n```\n\n## Correlation Between Pollutants\n\nLet's explore the correlation between different pollutants:\n\n```{r fig.height=8, fig.width=10}\nair_quality %>%\n  select(aqi, pm25, pm10, no2) %>%\n  cor() %>%\n  as.data.frame() %>%\n  tibble::rownames_to_column(\"pollutant1\") %>%\n  tidyr::pivot_longer(-pollutant1, names_to = \"pollutant2\", values_to = \"correlation\") %>%\n  ggplot(aes(x = pollutant1, y = pollutant2, fill = correlation)) +\n  geom_tile() +\n  geom_text(aes(label = round(correlation, 2)), color = \"white\", size = 4) +\n  scale_fill_gradient2(low = \"blue\", mid = \"white\", high = \"red\", midpoint = 0.5) +\n  labs(\n    title = \"Correlation Between Pollutants\",\n    x = NULL,\n    y = NULL,\n    fill = \"Correlation\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    panel.grid = element_blank()\n  )\n```\n\n## Key Findings\n\nFrom our analysis, we can observe:\n\n1. **City Differences**: Beijing shows the highest average AQI levels, followed by Tokyo and New York.\n2. **Pollutant Relationships**: PM10 and AQI show the strongest correlation, which is expected as PM10 is a major component of air quality calculations.\n3. **Seasonal Patterns**: All cities show some fluctuation in air quality over the period, with some improvement trends visible in specific cities.\n4. **Quality Categories**: London has the highest percentage of \"Good\" air quality days, while Beijing has the highest percentage of \"Unhealthy\" days.\n\n## Conclusions\n\nThis analysis demonstrates the variability in air quality across major global cities. The data shows that while some cities struggle with consistently poor air quality, others maintain relatively good air quality levels throughout the period. These findings highlight the need for continued monitoring and targeted interventions in cities with persistent air quality issues.\n\nFor a more comprehensive analysis, future work could explore:\n- Correlation with weather patterns\n- Impact of policy interventions on air quality\n- Relationship between air quality and health outcomes in each city\n\n## Sources and Further Reading\n\n- World Health Organization Air Quality Guidelines\n- Environmental Protection Agency Air Quality Index\n- [Our World in Data - Air Pollution](https://ourworldindata.org/air-pollution)\n\n```{r echo=FALSE}\n# Add code to save the thumbnail for the listing page\nggsave(\"thumbnail.png\", \n       plot = ggplot(air_quality, aes(x = date, y = aqi, color = city)) +\n         geom_line() +\n         geom_smooth(method = \"loess\", se = FALSE, alpha = 0.5) +\n         labs(title = \"Air Quality Index Over Time\") +\n         theme_minimal(),\n       width = 6, height = 4)\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../resources/styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":"cosmo","page-layout":"full","title":"Week 2: Global Air Quality","description":"Analyzing air quality measurements across major global cities","date":"2025-02-12","categories":["time series","air quality","environmental"],"image":"thumbnail.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}